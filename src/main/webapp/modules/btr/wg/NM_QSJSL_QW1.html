<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>签收及时率</title>
	<link rel="stylesheet" type="text/css" href="../../dm/common.css">
	<script type="text/javascript" src="../../framework/core.js"></script>
	<script type="text/javascript" src="../../framework/ajax.js"></script>
	<script  src="../../tools/ichartjs/ichart.1.1.min.js"></script>
	<script  src="../../dm/common.js"></script>
	<script type="text/javascript">

    window.onload = function() {
        var globalValiable = window.parent.globalValiable;
        if(globalValiable && globalValiable.data) {
            queryParams = globalValiable.queryParams;
            title = queryParams.param1 +'至' + queryParams.param2 + '日'  +'全网签收及时率';
            show(globalValiable.data);
            return;
        }
    } 

	
	function show(originData) {
		var total = 0;
		var dataW = [];
		var dataW1 = [];
		var dataW2 = [];
		var dataDay = [];
		var showDay = [];
		var maxdata = 0;
		var mindata = 99999;
		var maxdata1 = 0;
		var mindata1 = 1;
		var maxDay = 0;
		var minDay = 0;
		var scaledata = 0;
		var scaledata1 = 0;
		var spaceData = 0;
		var weekday;

		for(var i = 0; i < originData.length; i++) {
			var weight = originData[i]["及时签收"];
			var weight1 = originData[i]["未及时签收"];
			var weight2 = originData[i]["签收及时率"];
			var dateIn = originData[i]["日期"];
			weekday = "天一二三四五六".charAt(new Date(dateIn).getDay());
			if (maxdata<weight+weight1) {
				maxdata = weight+weight1;
				maxDay = dateIn
			}
			if (mindata>weight+weight1) {
				mindata = weight+weight1;
				minDay = dateIn
			}
			if (maxdata1<weight2) {
				maxdata1 = weight2;
				maxDay = dateIn
			}
			if (mindata1>weight2) {
				mindata1 = weight2;
				minDay = dateIn
			}
			scaledata=Math.floor(maxdata/1000)*1000+3000;
			scaledata1=Math.floor(mindata/100)*100 ;

			if (i % Math.round(originData.length/10) == 0){
				showDay[i] = dateIn + '\n' + "星期" + weekday;
			}
			else{
				showDay[i] = ' ';
			}

			total += weight+weight1;
			dataW[i] = weight;
			dataW1[i] = weight1;
			dataW2[i] = weight2*100;
			dataDay[i] = dateIn + '\n' + "星期" + weekday;
		}

		spaceData=(scaledata-0)/5;

		var autoSize  = autoAdjustSize("canvasDiv");
		
$(function(){

			var data = [

			         	{

			         		name : '及时签收',

			         		value:dataW,

			         		color:'#32bdbc'

			         	},

			         	{

			         		name : '未及时签收',

			         		value:dataW1,

			         		color:'#d75a5e'

			         	}

			         ];
					var data1 = [

			         	{

			         		name : '签收及时率',

			         		value:dataW2,

			         		color:'#34a1d9',
							
							line_width:5


			         	}

			         ];
			

	        var labels=showDay;

			var chart = new iChart.ColumnStacked2D({

					render : 'canvasDiv',

					data: data,

					labels:labels,

					title : {

						text:title,

						color:'#dcd6cb',

						textAlign:'center',

						padding:'0 40',

						font:'微软雅黑',

						border:{

							enable:true,

							width:[0,0,4,0],

							color:'#698389'

						},

						height:40

					},
					subtitle : {

					text:'签收总数最大值：'+maxdata+'		签收总数最小值：'+mindata+'		签收及时率最大值：'+maxdata1*100+'%'+'		签收及时率最小值：'+mindata1*100+'%',

					color:'#afb6c0'

					},



					footnote : {

						text:'',

						font:'微软雅黑',

						padding:'0 8',

						color:'#dcd6cb'

					},

					padding:'8 0',

					width :autoSize[0],

					height : autoSize[1],

					//column_width:70,

					gradient : true,//应用背景渐变

					gradient_mode:'LinearGradientDownUp',//渐变类型

					color_factor : 0.1,//渐变因子

					background_color : '#425154',

					sub_option:{

						label:{color:'#f9f9f9',fontsize:12,fontweight:600},

						border : false

					},

					label:{color:'#dcd6cb',font:'微软雅黑',fontsize:12,fontweight:600},

					legend:{

						enable:true,

						background_color : null,

						line_height:25,

						color:'#dcd6cb',

						fontsize:12,

						font:'微软雅黑',

						fontweight:600,

						border : {

							enable : false

						}

					},

					//column_width:100,

					coordinate:{

						background_color : 0,

						grid_color:'#888888',

						axis : {

							color : '#c0d0e0',

							width :0

						}, 

						scale:[{

							 position:'left',	

							 scale_enable : true,

							 start_scale:0,

							 scale_space:spaceData,

							 end_scale:scaledata,

							 listeners:{

							parseText:function(t,x,y){

								return {text:t+"票"}

							}

							}},
							{

							 position:'right',	

							 scale_enable : true,

							 start_scale:0,

							 scale_space:20,

							 end_scale:100,

							 listeners:{

							parseText:function(t,x,y){

								return {text:t+"%"}

							}

							}


						}],

						width:'85%',

						height:'70%'

					}

			});
			
			var line = new iChart.LineBasic2D({

				z_index:1000,

				data: data1,

				label:labels,

				point_space:chart.get('column_width')+chart.get('column_space'),

				scaleAlign : 'right',

				sub_option : {

					smooth :false,//平滑曲线

						point_size:25,
						listeners:{

							parseText:function(r,t){

								return t+"%";

							}

						}
				},

				coordinate:chart.coo//共用坐标系

			});

			

			chart.plugin(line);
			chart.draw();

		});

	




}
	
	
	</script>
</head>

<body>
	
	<div id='canvasDiv'></div>

</body>
</html>
