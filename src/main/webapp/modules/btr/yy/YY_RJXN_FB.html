<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
</head>
<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
  
    <!-- ECharts单文件引入 -->
   <script src="../../tools/echarts-2.0.4/echarts-plain.js"></script>
    <script type="text/javascript">
	window.onload = function() {
        var globalValiable = window.parent.globalValiable;
        if(globalValiable && globalValiable.data) {
            queryParams = globalValiable.queryParams;
            title = queryParams.param1 +'至' + queryParams.param2 + '日'  +queryParams.param4+'人均效能';
            show(globalValiable.data,queryParams.param1);
            return;
        }
    } 

 
	function show(originData,subtitle) {
		var total = 0;
		var datar = [];
		var datar2 = [];
		var datar3 = [];
		var dataload = [];
		var label = [];
		var showDay=[];
		var dataDay=[];
		var weekday;
		var maxdata=0;
		var maxdatar=0;
		var maxdataw=0;
		var mindata=100;
		var scaledata=0;
				
		for(var i = 0; i < originData.length; i++) {
			var brst = originData[i]["人均效能"];
			var brst2 = originData[i]["人员"];
			var brst3 = originData[i]["货量"];
			
			var routine = originData[i]["日期"];
			if (maxdata<brst) {
				maxdata=brst
			}
			if (maxdatar<brst2) {
				maxdatar=brst2
			}
			if (maxdataw<brst3) {
				maxdataw=brst3
			}
			if (mindata>brst) {
				mindata=brst
			}
			weekday = "天一二三四五六".charAt(new Date(routine).getDay());
			if (i % Math.round(originData.length/10) == 0){
				showDay[i] = routine + '\n' + "星期" + weekday;
			}
			else{
				showDay[i] = ' ';
			}
			scaledata=Math.round(maxdata)*100  + 0;

			total += brst;
			datar[i] = brst;
			datar2[i] = brst2;
			datar3[i] = brst3;
			dataDay[i] = routine + '\n' + "星期" + weekday;
			label[i] = routine;
		}

var myChart = echarts.init(document.getElementById('main'));
option = {
	title : {
        text:''
        
    },
    tooltip : {
        trigger: 'axis'
    },
    toolbox: {
        show : true,
        
        feature : {
            mark : {show: true},
            dataView : {show: true, readOnly: false},
            magicType : {show: true, type: ['line', 'bar']},
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },
	dataZoom : {
        show : true,
        realtime : true
        
	},
    calculable : true,
    legend: {
        data:['人均效能','人员','货量']
    },
    xAxis : [
        {
            type : 'category',
            splitLine : {show : false},
            data : dataDay
        }
    ],
    yAxis : [
        {
            type : 'value',
			name:'人员',
			namelocation:'end',
            position: 'left',
			max:maxdatar+Math.round(maxdatar*0.2),
			min:0,
			splitNumber :maxdatar
			
			
        },
		 {
            type : 'value',
			name:'货量',
			namelocation:'start',
			/*max:maxdataw*1.2,
			min:0,*/
            splitLine:
			{
				show:false,
			 	lineStyle:
				{width:0 }
			},
            axisLabel : {
                formatter: function (value) {
                    // Function formatter
                    return value + ''
                }
            }
		 }
    ],
    series : [
        {
            name:'人员',
            type:'bar',
            data:datar2,
			markPoint : {
                data : [
                    {type : 'max', name: '最大值'},
                    {type : 'min', name: '最小值'}
                ]
            },
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        },
        {
            name:'货量',
            type:'bar',
            data:datar3,
			yAxisIndex: 1,
			markPoint : {
                data : [
                    {type : 'max', name: '最大值'},
                    {type : 'min', name: '最小值'}
                ]
            },
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        }/*,
        
        
        {
            name:'人均效能',
            type:'line',
            data:datar,
			
        }

        */
        
    ]
};           
   myChart.setOption(option); 
   var myChart2 = echarts.init(document.getElementById('main2'));
  option2 = {
    title : {
        text:  title
    },
    tooltip : {
        trigger: 'axis'
    },
    legend: {
        data:['人均效能','人员','货量']
    },
    /*toolbox: {
        show : true,
        feature : {
            mark : {show: true},
            dataView : {show: true, readOnly: false},
            magicType : {show: true, type: ['line', 'bar']},
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },*/
    calculable : true,
    xAxis : [
        {
            type : 'category',
            boundaryGap : false,
            data : dataDay
        }
    ],
    yAxis : [
        {
            type : 'value',
            axisLabel : {
                formatter: '{value}'
            }
        }
    ],
    series : [
        {
            name:'人均效能',
            type:'line',
            data:datar,
            markPoint : {
                data : [
                    {type : 'max', name: '最大值'},
                    {type : 'min', name: '最小值'}
                ]
            },
            markLine : {
                data : [
                    {type : 'average', name: '平均值'}
                ]
            }
        
        }
    ]
};
//myChart2.setOption(option2); 
//myChart2 = echarts.init(document.getElementById('main2'));
myChart2.setOption(option2);

myChart.connect(myChart2);
myChart2.connect(myChart);

/*setTimeout(function (){
    window.onresize = function () {
        myChart.resize();
        myChart2.resize();
    }
},200)
         */           
                    
	}
    </script>
</body>
